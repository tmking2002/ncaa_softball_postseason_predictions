source("get_power_ratings.R")
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
postseason = ifelse(game_date >= "2021-05-21",T,F))
library(softballR)
library(tidyverse)
library(anytime)
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
postseason = ifelse(game_date >= "2021-05-21",T,F))
regular_season_2021 <- scoreboard_2021 %>%
filter(postseason == F)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T)
power_ratings_2021 <- get_power_ratings(regular_season_2021)
View(power_ratings_2021)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team")
View(postseason_2021)
View(power_ratings_2021)
power_ratings_2021 <- get_power_ratings(regular_season_2021) %>%
select(offensive_rating, defensive_rating, rank)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team")
power_ratings_2021 <- get_power_ratings(regular_season_2021) %>%
select(team, offensive_rating, defensive_rating, rank)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team")
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2021, by.x = "away_team", by.y = "team")
View(scoreboard_2021)
View(power_ratings_2021)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2021, by.x = "away_team", by.y = "team")
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + offensive_rating.y, data = postseason_2021)
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + offensive_rating.y,
data = postseason_2021, family = "binomial")
summary(model)
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + defensive_rating.y,
data = postseason_2021, family = "binomial")
summary(model)
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + power_rating.x
offensive_rating.y + defensive_rating.y + power_rating.y,
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + power_rating.x +
offensive_rating.y + defensive_rating.y + power_rating.y,
data = postseason_2021, family = "binomial")
power_ratings_2021 <- get_power_ratings(regular_season_2021) %>%
select(team, offensive_rating, defensive_rating, power_rating, rank)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2021, by.x = "away_team", by.y = "team")
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + power_rating.x +
offensive_rating.y + defensive_rating.y + power_rating.y,
data = postseason_2021, family = "binomial")
summary(model)
View(postseason_2021)
power_ratings_2021 <- get_power_ratings(regular_season_2021) %>%
select(team, offensive_rating, defensive_rating, power_rating, rank)
postseason_2021 <- scoreboard_2021 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2021, by.x = "away_team", by.y = "team")
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + defensive_rating.y,
data = postseason_2021, family = "binomial")
summary(model)
library(softballR)
library(tidyverse)
library(anytime)
source("get_power_ratings.R")
scoreboard_2017 <- load_ncaa_scoreboard(2017) %>% mutate(game_date = anydate(game_date),
season = 2017,
postseason = ifelse(game_date >= "2021-05-18",T,F))
scoreboard_2018 <- load_ncaa_scoreboard(2018) %>% mutate(game_date = anydate(game_date),
season = 2018,
postseason = ifelse(game_date >= "2021-05-18",T,F))
scoreboard_2019 <- load_ncaa_scoreboard(2019) %>% mutate(game_date = anydate(game_date),
season = 2019,
postseason = ifelse(game_date >= "2021-05-31",T,F))
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
season = 2021,
postseason = ifelse(game_date >= "2021-05-21",T,F))
regular_season <- rbind(paste0("scoreboard_",c("2017","2018","2019","2021"))) %>%
filter(postseason == F)
library(softballR)
library(tidyverse)
library(anytime)
regular_season <- rbind(paste0("scoreboard_",c("2017","2018","2019","2021"))) %>%
filter(postseason == F)
regular_season <- rbind(paste0("scoreboard_",c("2017","2018","2019","2021")))
regular_season <- do.call(rbind,paste0("scoreboard_",c("2017","2018","2019","2021"))) %>%
filter(postseason == F)
regular_season <- do.call(rbind,list(paste0("scoreboard_",c("2017","2018","2019","2021")))) %>%
filter(postseason == F)
regular_season <- do.call(rbind,list(paste0("scoreboard_",c("2017","2018","2019","2021"))))
regular_season <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F)
power_ratings <- data.frame()
for(i in c(2017, 2018, 2019, 2021)){
curr_power_ratings <- get_power_ratings(regular_season %>% filter(season == i))
power_ratings <- rbind(power_ratings, curr_power_ratings %>% mutate(season = i))
}
View(power_ratings)
names(regular_season)
teams <- rbind(regular_season[c(1,12)], regular_season[c(5,12)])
teams <- rbind(regular_season[c(1,12)] %>% `names<-`(c("team","season")),
regular_season[c(5,12)] %>% `names<-`(c("team","season")))
teams <- rbind(regular_season[c(1,12)] %>% `names<-`(c("team","season")),
regular_season[c(5,12)] %>% `names<-`(c("team","season"))) %>%
group_by(team, season) %>%
summarise(count = n()) %>%
filter(count >= 20)
View(teams)
source("get_power_ratings.R")
scoreboard_2017 <- load_ncaa_scoreboard(2017) %>% mutate(game_date = anydate(game_date),
season = 2017,
postseason = ifelse(game_date >= "2021-05-18",T,F))
scoreboard_2018 <- load_ncaa_scoreboard(2018) %>% mutate(game_date = anydate(game_date),
season = 2018,
postseason = ifelse(game_date >= "2021-05-18",T,F))
scoreboard_2019 <- load_ncaa_scoreboard(2019) %>% mutate(game_date = anydate(game_date),
season = 2019,
postseason = ifelse(game_date >= "2021-05-31",T,F))
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
season = 2021,
postseason = ifelse(game_date >= "2021-05-21",T,F))
regular_season <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F)
power_ratings <- data.frame()
for(i in c(2017, 2018, 2019, 2021)){
curr_power_ratings <- get_power_ratings(regular_season %>% filter(season == i))
power_ratings <- rbind(power_ratings, curr_power_ratings %>% mutate(season = i))
}
View(power_ratings)
postseason_2021 <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2021, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2021, by.x = "away_team", by.y = "team")
postseason_2021 <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings, by.x = c("home_team","season"), by.y = c("team","season")) %>%
merge(power_ratings, by.x = c("away_team","season"), by.y = c("team","season"))
postseason <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings, by.x = c("home_team","season"), by.y = c("team","season")) %>%
merge(power_ratings, by.x = c("away_team","season"), by.y = c("team","season"))
postseason <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings, by.x = c("home_team","season"), by.y = c("team","season")) %>%
merge(power_ratings, by.x = c("away_team","season"), by.y = c("team","season"))
View(power_ratings)
View(postseason)
library(softballR)
library(tidyverse)
library(anytime)
source("get_power_ratings.R")
scoreboard_2017 <- load_ncaa_scoreboard(2017) %>% mutate(game_date = anydate(game_date),
season = 2017,
postseason = ifelse(game_date >= "2017-05-18",T,F))
scoreboard_2018 <- load_ncaa_scoreboard(2018) %>% mutate(game_date = anydate(game_date),
season = 2018,
postseason = ifelse(game_date >= "2018-05-18",T,F))
scoreboard_2019 <- load_ncaa_scoreboard(2019) %>% mutate(game_date = anydate(game_date),
season = 2019,
postseason = ifelse(game_date >= "2019-05-31",T,F))
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
season = 2021,
postseason = ifelse(game_date >= "2021-05-21",T,F))
regular_season <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F)
power_ratings <- data.frame()
for(i in c(2017, 2018, 2019, 2021)){
curr_power_ratings <- get_power_ratings(regular_season %>% filter(season == i))
power_ratings <- rbind(power_ratings, curr_power_ratings %>% mutate(season = i))
}
postseason <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings, by.x = c("home_team","season"), by.y = c("team","season")) %>%
merge(power_ratings, by.x = c("away_team","season"), by.y = c("team","season"))
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + defensive_rating.y,
data = postseason, family = "binomial")
summary(model)
postseason_2022 <- scoreboard_2022 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2022, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2022, by.x = "away_team", by.y = "team")
scoreboard_2022 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
postseason = ifelse(game_date >= "2022-05-20",T,F))
regular_season_2022 <- scoreboard_2022 %>%
filter(postseason == F)
power_ratings_2022 <- get_power_ratings(regular_season_2022)
postseason_2022 <- scoreboard_2022 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2022, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2022, by.x = "away_team", by.y = "team")
View(power_ratings_2022)
postseason_2022 <- scoreboard_2022 %>%
filter(postseason == T)
View(scoreboard_2022)
scoreboard_2022 <- load_ncaa_scoreboard(2022) %>% mutate(game_date = anydate(game_date),
postseason = ifelse(game_date >= "2022-05-20",T,F))
scoreboard_2022 <- load_ncaa_scoreboard(2022)
View(scoreboard_2022)
scoreboard <- get_ncaa_season_scoreboard(2022)
saveRDS("~/Projects/softballR-data/data/ncaa_scoreboard_2022.RDS")
saveRDS(scoreboard, "~/Projects/softballR-data/data/ncaa_scoreboard_2022.RDS")
library(softballR)
library(tidyverse)
library(anytime)
source("get_power_ratings.R")
scoreboard_2017 <- load_ncaa_scoreboard(2017) %>% mutate(game_date = anydate(game_date),
season = 2017,
postseason = ifelse(game_date >= "2017-05-18",T,F))
scoreboard_2018 <- load_ncaa_scoreboard(2018) %>% mutate(game_date = anydate(game_date),
season = 2018,
postseason = ifelse(game_date >= "2018-05-18",T,F))
scoreboard_2019 <- load_ncaa_scoreboard(2019) %>% mutate(game_date = anydate(game_date),
season = 2019,
postseason = ifelse(game_date >= "2019-05-31",T,F))
scoreboard_2021 <- load_ncaa_scoreboard(2021) %>% mutate(game_date = anydate(game_date),
season = 2021,
postseason = ifelse(game_date >= "2021-05-21",T,F))
regular_season <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == F)
power_ratings <- data.frame()
for(i in c(2017, 2018, 2019, 2021)){
curr_power_ratings <- get_power_ratings(regular_season %>% filter(season == i))
power_ratings <- rbind(power_ratings, curr_power_ratings %>% mutate(season = i))
}
postseason <- rbind(scoreboard_2017, scoreboard_2018, scoreboard_2019, scoreboard_2021) %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings, by.x = c("home_team","season"), by.y = c("team","season")) %>%
merge(power_ratings, by.x = c("away_team","season"), by.y = c("team","season"))
model <- glm(home_win ~ offensive_rating.x + defensive_rating.x + offensive_rating.y + defensive_rating.y,
data = postseason, family = "binomial")
scoreboard_2022 <- load_ncaa_scoreboard(2022) %>% mutate(game_date = anydate(game_date),
postseason = ifelse(game_date >= "2022-05-20",T,F))
regular_season_2022 <- scoreboard_2022 %>%
filter(postseason == F)
power_ratings_2022 <- get_power_ratings(regular_season_2022)
postseason_2022 <- scoreboard_2022 %>%
filter(postseason == T) %>%
mutate(home_win = home_team_runs > away_team_runs) %>%
merge(power_ratings_2022, by.x = "home_team", by.y = "team") %>%
merge(power_ratings_2022, by.x = "away_team", by.y = "team")
View(postseason_2022)
postseason_2022$pred <- predict(model, postseason_2022, type = "response")
View(postseason_2022)
postseason_2022$pred_home_win <- postseason_2022$pred > .5
table(postseason_2022$home_win, postseason_2022$pred_home_win)
37+56 / (37+56+31+18)
(37+56) / (37+56+31+18)
View(regular_season)
View(postseason_2022)
tictoc::tic(); get_ncaa_season_player_box(532499); tictoc::toc()
